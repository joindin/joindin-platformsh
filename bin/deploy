#!/usr/bin/env bash
ENVIRONMENT=$(git branch 2> /dev/null | sed -n -e 's/^\* \(.*\)/\1/p')

if [ -x "$(command -v platform)" ]; then
    platform snapshot:create
fi

STASHED=false
if ! git diff-index --quiet HEAD --; then
    git stash
    STASHED=true
fi
git submodule update --recursive --remote
git add api/joindin-api
git add web/joindin-web
git commit -a -m "Automatic Module Update"
if ${STASHED}; then
    git stash pop
fi

ENVIRONMENT=${1:-$ENVIRONMENT}
git push -u origin ${ENVIRONMENT}
